<VirtualHost *:443>
    SSLEngine On
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

#   RewriteEngine On
#   RewriteRule ^/postauth*$ /[R]

    ProxyRequests On
    ProxyPreserveHost On

#    OIDCProviderUserInfoEndpoint    https://repo-prod.prod.sagebase.org/auth/v1/userinfo
#    OIDCCryptoPassphrase secretstring
#    OIDCRedirectURI https://localhost
#    OIDCOAuthIntrospectionEndpointMethod    GET
#    OIDCSSLValidateServer    Off
#    OIDCUserInfoTokenMethod authz_header
##    OIDCOAuthIntrospectionTokenParamName    access_token
#    OIDCRemoteUserClaim userid
#    OIDCHTTPTimeoutLong 5

  <Proxy "*">
     AuthType oauth2
#    OAuth2TokenVerify metadata https://repo-prod.prod.sagebase.org/auth/v1/.well-known/openid-configuration
     OAuth2TokenVerify eckey_uri https://public-keys.auth.elb.us-east-1.amazonaws.com/kid
#    Require valid-user
     OAuth2TargetPass remote_user_claim=userid
#    Require claim userid:${APPROVED_USER}
  </Proxy>

#  <Location />
#    AuthType oauth2
#    OAuth2TokenVerify metadata https://repo-prod.prod.sagebase.org/auth/v1/.well-known/openid-configuration
#    Require valid-user
#    Require claim userid:${APPROVED_USER}
#APPROVED_USER is a variable in ../envvars
#REMOTE_USER is set by the OAuth introspection
#    Require ${REMOTE_USER} ${APPROVED_USER}
    ProxyPass /postauth/ http://localhost:8787/
    ProxyPassReverse /postauth/ http://localhost:8787/
#  </Location>

</VirtualHost>
