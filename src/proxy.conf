<VirtualHost _default_:443>
  ServerName proxy.localhost

  SSLEngine On
  SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
  SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

  ProxyRequests Off
  ProxyPreserveHost On

  #Block requests that do not have an X-Amzn-Oidc-Data header
  RewriteEngine On
  RewriteCond %{HTTP:X-Amzn-Oidc-Data} ^$
  RewriteRule ^ - [F]

  RewriteCond %{HTTP:Upgrade} =websocket
  RewriteRule /(.*)     ws://localhost:8787/$1  [P,L]
  RewriteCond %{HTTP:Upgrade} !=websocket
  RewriteRule /(.*)     http://localhost:8787/$1 [P,L]

  Header add X-RStudio-Username "ubuntu"

  <Location />    
    AddHandler mod_python .py
    PythonPath "sys.path+['/usr/lib/cgi-bin', 'usr/lib/python36.zip', '/usr/lib/python3.6', '/usr/lib/python3.6/lib-dynload', '/usr/local/lib/python3.6/dist-packages', '/usr/lib/python3/dist-packages']"
    PythonHandler access
    PythonHeaderParserHandler access
    ProxyPass http://localhost:8787/
    ProxyPassReverse http://localhost:8787/
  </Location>
</VirtualHost>
